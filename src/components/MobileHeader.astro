---
import { SITE_TITLE } from '../lib/constants'

export interface Props {
  currentPath?: string
  showLogo?: boolean
  showSearch?: boolean
  sticky?: boolean
}

const {
  currentPath = Astro.url.pathname,
  showLogo = true,
  showSearch = true,
  sticky = true
} = Astro.props
---

<header class={`mobile-header ${sticky ? 'sticky top-0' : ''} z-50 bg-white/98 backdrop-blur-md border-b border-gray-100/50 shadow-header`} role="navigation" aria-label="Main navigation">
  <div class="container mx-auto px-4 sm:px-6 py-4">
    <div class="flex items-center justify-between">
      <!-- Mobile Logo -->
      {showLogo && (
        <a
          href="/"
          class="flex items-center gap-3 group transition-all duration-200 hover:scale-[1.02]"
          aria-label={`${SITE_TITLE} Home`}
        >
          <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-primary-600 to-primary-700 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl group-hover:-rotate-2 transition-all duration-300">
            <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
            </svg>
          </div>
          <div class="flex flex-col">
            <span class="text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-primary-600 to-primary-700 bg-clip-text text-transparent leading-tight">
              Megawe
            </span>
            <span class="text-xs sm:text-sm text-gray-500 hidden sm:block">Lowongan Kerja Indonesia</span>
          </div>
        </a>
      )}

      <!-- Mobile Actions -->
      <div class="flex items-center gap-2">
        <!-- Mobile Search Toggle -->
        {showSearch && (
          <button
            type="button"
            class="mobile-search-toggle p-2 sm:p-3 rounded-lg hover:bg-gray-100 transition-all duration-200 touch-manipulation min-h-44"
            aria-label="Toggle search"
            aria-expanded="false"
            onclick="this.closest('.mobile-header').querySelector('.mobile-search-panel').classList.toggle('hidden')"
          >
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </button>
        )}

        <!-- Mobile Menu Button -->
        <button
          type="button"
          class="mobile-menu-toggle p-2 sm:p-3 rounded-lg hover:bg-gray-100 transition-all duration-200 touch-manipulation min-h-44"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
          onclick="toggleMobileMenu()"
        >
          <svg class="w-6 h-6 sm:w-7 sm:h-7 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Search Panel -->
    <div class="mobile-search-panel hidden mt-4 pt-4 border-t border-gray-200 animate-slide-down">
      <form action="/jobs/search" method="GET" class="relative">
        <input
          type="text"
          name="q"
          placeholder="Cari lowongan kerja..."
          class="w-full px-4 py-3 pr-12 text-base rounded-xl border border-gray-200 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 transition-all duration-200"
          autocomplete="off"
          aria-label="Search jobs"
        />
        <button
          type="submit"
          class="absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200 min-h-44"
          aria-label="Submit search"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </button>
      </form>
    </div>

    <!-- Mobile Navigation Menu -->
    <nav id="mobile-menu" class="mobile-menu hidden mt-4 pt-4 border-t border-gray-200" role="navigation" aria-label="Mobile navigation menu">
      <div class="flex flex-col space-y-2">
        <a
          href="/jobs"
          class="mobile-nav-link flex items-center justify-between px-4 py-3 text-base font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all duration-200 active:scale-98"
          aria-current={currentPath?.startsWith('/jobs') ? 'page' : undefined}
        >
          <span>Lowongan Kerja</span>
          <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>

        <a
          href="/employers"
          class="mobile-nav-link flex items-center justify-between px-4 py-3 text-base font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all duration-200 active:scale-98"
          aria-current={currentPath?.startsWith('/employers') ? 'page' : undefined}
        >
          <span>Perusahaan</span>
          <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>

        <a
          href="/karir"
          class="mobile-nav-link flex items-center justify-between px-4 py-3 text-base font-medium text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-all duration-200 active:scale-98"
          aria-current={currentPath?.startsWith('/karir') ? 'page' : undefined}
        >
          <span>Karir Tips</span>
          <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>

        <div class="border-t border-gray-200 pt-4 mt-4">
          <div class="flex gap-3">
            <button class="flex-1 px-4 py-3 text-primary-600 bg-primary-50 rounded-lg font-medium text-sm sm:text-base border border-primary-200 hover:bg-primary-100 transition-all duration-200 active:scale-98 min-h-44">
              Masuk
            </button>
            <button class="flex-1 px-4 py-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-lg font-semibold text-sm sm:text-base shadow-button hover:shadow-card hover:from-primary-700 hover:to-primary-800 transition-all duration-200 active:scale-98 min-h-44">
              Daftar
            </button>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="bg-gradient-to-r from-primary-50 to-secondary-50 rounded-lg p-4 mt-4 border border-primary-100">
          <div class="grid grid-cols-2 gap-4 text-center">
            <div>
              <div class="text-lg font-bold text-primary-600">1,000+</div>
              <div class="text-xs text-gray-600">Lowongan</div>
            </div>
            <div>
              <div class="text-lg font-bold text-secondary-600">500+</div>
              <div class="text-xs text-gray-600">Perusahaan</div>
            </div>
          </div>
        </div>
      </div>
    </nav>
  </div>
</header>

<!-- Mobile Menu Toggle Script -->
<script is:inline>
  function toggleMobileMenu() {
    const toggleButton = document.querySelector('.mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');

    if (toggleButton && mobileMenu) {
      const isExpanded = toggleButton.getAttribute('aria-expanded') === 'true';
      toggleButton.setAttribute('aria-expanded', !isExpanded);
      mobileMenu.classList.toggle('hidden');

      // Animate hamburger to X
      if (!isExpanded) {
        toggleButton.innerHTML = `
          <svg class="w-6 h-6 sm:w-7 sm:h-7 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        `;
      } else {
        toggleButton.innerHTML = `
          <svg class="w-6 h-6 sm:w-7 sm:h-7 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        `;
      }
    }
  }

  // Close mobile menu when clicking outside
  document.addEventListener('click', (event) => {
    const header = document.querySelector('.mobile-header');
    const mobileMenu = document.getElementById('mobile-menu');
    const toggleButton = document.querySelector('.mobile-menu-toggle');

    if (header && mobileMenu && toggleButton &&
        !header.contains(event.target) &&
        !mobileMenu.classList.contains('hidden')) {
      toggleButton.setAttribute('aria-expanded', 'false');
      mobileMenu.classList.add('hidden');

      toggleButton.innerHTML = `
        <svg class="w-6 h-6 sm:w-7 sm:h-7 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      `;
    }
  });

  // Close mobile menu on escape key
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      const mobileMenu = document.getElementById('mobile-menu');
      const toggleButton = document.querySelector('.mobile-menu-toggle');

      if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
        toggleButton.setAttribute('aria-expanded', 'false');
        mobileMenu.classList.add('hidden');

        toggleButton.innerHTML = `
          <svg class="w-6 h-6 sm:w-7 sm:h-7 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        `;
      }
    }
  });
</script>

<style>
  /* Enhanced mobile touch targets */
  .mobile-header button {
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    -webkit-user-select: none;
  }

  /* Smooth transitions for mobile menu */
  .mobile-nav-link {
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  /* Active state animations */
  .mobile-nav-link:active {
    transform: scale(0.98);
  }

  /* Focus styles for accessibility */
  .mobile-nav-link:focus-visible,
  .mobile-header button:focus-visible {
    outline: 2px solid theme('colors.primary.600');
    outline-offset: 2px;
  }

  /* Enhanced search input for mobile */
  @media (max-width: 640px) {
    .mobile-search-panel input {
      font-size: 16px; /* Prevent zoom on iOS */
      -webkit-appearance: none;
      border-radius: 12px;
    }
  }

  /* Safe area support for notched devices */
  @supports (padding: max(0px)) {
    .mobile-header {
      padding-top: max(env(safe-area-inset-top), 1rem);
    }
  }
</style>
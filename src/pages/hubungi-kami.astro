---
import Layout from '../layouts/Layout.astro'
import { SITE_URL } from '../lib/constants'

// SEO Metadata
const title = "Hubungi Kami - Megawe | Agregator Lowongan Kerja Indonesia"
const description = "Hubungi tim Megawe untuk pertanyaan seputar lowongan kerja, partnership, atau dukungan teknis. Kami adalah aggregator lowongan kerja terpercaya dari Karirhub Kemnaker."
const url = `${SITE_URL}/hubungi-kami`
const image = `${SITE_URL}/images/contact-hero.jpg`

// Structured Data
const structuredData = {
  "@context": "https://schema.org",
  "@type": "ContactPage",
  "name": "Hubungi Kami - Megawe",
  "description": "Halaman kontak untuk agregator lowongan kerja Megawe Indonesia",
  "url": url,
  "mainEntity": {
    "@type": "Organization",
    "name": "Megawe",
    "url": SITE_URL,
    "logo": `${SITE_URL}/logo.png`,
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "customer service",
      "availableLanguage": ["Indonesian", "English"],
      "email": "support@megawe.net"
    }
  }
}
---

<Layout title={title} description={description} url={url} image={image}>
  <!-- Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-red-50 via-white to-emerald-50 py-16 lg:py-24">
    <div class="container mx-auto px-6">
      <div class="text-center max-w-4xl mx-auto">
        <h1 class="text-4xl lg:text-6xl font-bold text-gray-900 mb-6">
          Hubungi <span class="bg-gradient-to-r from-red-600 to-emerald-600 bg-clip-text text-transparent">Tim Megawe</span>
        </h1>
        <p class="text-xl text-gray-600 mb-8 leading-relaxed">
          Sebagai aggregator lowongan kerja terpercaya dari Karirhub Kemnaker,
          kami siap membantu Anda menemukan peluang karir terbaik di Indonesia.
        </p>

        <!-- Contact Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
            <div class="text-3xl font-bold text-red-600 mb-2">164+</div>
            <div class="text-gray-600">Lowongan Aktif</div>
          </div>
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
            <div class="text-3xl font-bold text-emerald-600 mb-2">1000+</div>
            <div class="text-gray-600">Perusahaan Terpercaya</div>
          </div>
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
            <div class="text-3xl font-bold text-orange-600 mb-2">24/7</div>
            <div class="text-gray-600">Dukungan Online</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact Information Section -->
  <section class="py-16">
    <div class="container mx-auto px-6">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 max-w-6xl mx-auto">

        <!-- Contact Form -->
        <div class="bg-white rounded-2xl shadow-lg p-8 lg:p-10">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">
            Kirim Pesan kepada Kami
          </h2>

          <form id="contactForm" class="space-y-6">
            <!-- Name -->
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                Nama Lengkap *
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200"
                placeholder="Masukkan nama lengkap Anda"
              >
            </div>

            <!-- Email -->
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                Email Aktif *
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200"
                placeholder="email@example.com"
              >
            </div>

            <!-- Subject -->
            <div>
              <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">
                Subjek Pesan *
              </label>
              <select
                id="subject"
                name="subject"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200"
              >
                <option value="">Pilih subjek pesan</option>
                <option value="pertanyaan-lowongan">Pertanyaan Lowongan Kerja</option>
                <option value="kerjasama-perusahaan">Kerjasama Perusahaan</option>
                <option value="dukungan-teknis">Dukungan Teknis</option>
                <option value="laporan-masalah">Laporan Masalah</option>
                <option value="saran">Saran dan Masukan</option>
                <option value="lainnya">Lainnya</option>
              </select>
            </div>

            <!-- Message -->
            <div>
              <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
                Pesan Anda *
              </label>
              <textarea
                id="message"
                name="message"
                rows="5"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200 resize-none"
                placeholder="Jelaskan pertanyaan atau permintaan Anda secara detail..."
              ></textarea>
            </div>

            <!-- GDPR Consent -->
            <div class="bg-gray-50 p-4 rounded-lg">
              <label class="flex items-start space-x-3">
                <input
                  type="checkbox"
                  id="gdpr_consent"
                  name="gdpr_consent"
                  required
                  class="mt-1 w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"
                >
                <span class="text-sm text-gray-600">
                  Saya menyetujui <a href="/kebijakan-privasi" class="text-red-600 hover:text-red-700 underline">Kebijakan Privasi</a>
                  dan <a href="/syarat-ketentuan" class="text-red-600 hover:text-red-700 underline">Syarat & Ketentuan</a>
                  yang berlaku. Data Anda akan disimpan sesuai regulasi GDPR.
                </span>
              </label>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="w-full bg-gradient-to-r from-red-600 to-emerald-600 text-white font-semibold py-4 px-6 rounded-lg hover:from-red-700 hover:to-emerald-700 transition-all duration-200 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
            >
              Kirim Pesan
            </button>
          </form>

          <!-- Success Message -->
          <div id="successMessage" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <p class="text-green-800 font-medium">‚úÖ Pesan Anda telah terkirim! Kami akan membalas dalam 1x24 jam.</p>
          </div>

          <!-- Error Message -->
          <div id="errorMessage" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
            <p class="text-red-800 font-medium">‚ùå Terjadi kesalahan. Silakan coba lagi atau hubungi langsung ke email kami.</p>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="space-y-8">
          <!-- Important Notice -->
          <div class="bg-red-50 border border-red-200 rounded-xl p-6">
            <h3 class="text-lg font-semibold text-red-900 mb-3">
              üìå PENTING: Peran Kami Sebagai Aggregator
            </h3>
            <p class="text-red-800 leading-relaxed">
              Megawe adalah <strong>aggregator lowongan kerja</strong> yang bekerjasama dengan Karirhub Kemnaker.
              Kami <strong>tidak melakukan rekrutmen langsung</strong> dan tidak memungut biaya apapun kepada pencari kerja.
            </p>
          </div>

          <!-- Contact Methods -->
          <div class="space-y-6">
            <!-- Email -->
            <div class="flex items-start space-x-4">
              <div class="flex-shrink-0 w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              </div>
              <div>
                <h4 class="font-semibold text-gray-900">Email Support</h4>
                <p class="text-gray-600">support@megawe.net</p>
                <p class="text-sm text-gray-500">Respons dalam 1x24 jam kerja</p>
              </div>
            </div>

            <!-- Partnership -->
            <div class="flex items-start space-x-4">
              <div class="flex-shrink-0 w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
              </div>
              <div>
                <h4 class="font-semibold text-gray-900">Kerjasama Perusahaan</h4>
                <p class="text-gray-600">partnership@megawe.net</p>
                <p class="text-sm text-gray-500">Untuk perusahaan yang ingin memposting lowongan</p>
              </div>
            </div>

            <!-- Support Hours -->
            <div class="flex items-start space-x-4">
              <div class="flex-shrink-0 w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <h4 class="font-semibold text-gray-900">Jam Operasional</h4>
                <p class="text-gray-600">Senin - Jumat: 09:00 - 17:00 WIB</p>
                <p class="text-sm text-gray-500">Sabtu - Minggu: Online support</p>
              </div>
            </div>
          </div>

          <!-- FAQ Link -->
          <div class="bg-gradient-to-r from-red-50 to-emerald-50 rounded-xl p-6">
            <h4 class="font-semibold text-gray-900 mb-3">ü§î Pertanyaan Umum?</h4>
            <p class="text-gray-600 mb-4">
              Cek halaman FAQ kami untuk jawaban atas pertanyaan yang sering diajukan.
            </p>
            <a href="/faq" class="inline-flex items-center text-red-600 hover:text-red-700 font-medium">
              Lihat FAQ
              <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Partnership Information -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-6">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-gray-900 mb-6">
          Partnership Resmi dengan Karirhub Kemnaker
        </h2>
        <div class="bg-white rounded-2xl shadow-lg p-8">
          <div class="flex justify-center mb-6">
            <img src="/images/karirhub-logo.png" alt="Karirhub Kemnaker" class="h-16 object-contain" />
          </div>
          <p class="text-gray-600 leading-relaxed mb-6">
            Megawe adalah aggregator resmi dari lowongan kerja yang tersedia di platform Karirhub Kementerian Ketenagakerjaan Republik Indonesia.
            Semua lowongan yang kami tampilkan telah diverifikasi dan berasal dari sumber terpercaya.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
            <div class="text-center">
              <div class="text-2xl font-bold text-red-600 mb-2">‚úì</div>
              <div class="font-semibold">Terpercaya</div>
              <div class="text-sm text-gray-600">Sumber resmi pemerintah</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-emerald-600 mb-2">‚úì</div>
              <div class="font-semibold">Gratis</div>
              <div class="text-sm text-gray-600">Tidak ada biaya pendaftaran</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-orange-600 mb-2">‚úì</div>
              <div class="font-semibold">Update</div>
              <div class="text-sm text-gray-600">Lowongan terbaru setiap hari</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  // Contact Form Handler with Server-side Validation
  document.getElementById('contactForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    // Clear previous errors
    clearValidationErrors();

    const formData = new FormData(e.target);
    const data = {
      name: formData.get('name'),
      email: formData.get('email'),
      subject: formData.get('subject'),
      message: formData.get('message'),
      gdpr_consent: formData.get('gdpr_consent')
    };

    // Client-side validation first
    const clientErrors = validateClientSide(data);
    if (Object.keys(clientErrors).length > 0) {
      showValidationErrors(clientErrors);
      return;
    }

    // Show loading state
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Mengirim...';
    submitBtn.disabled = true;

    try {
      // Submit to secure API endpoint
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (!response.ok) {
        if (response.status === 400 && result.errors) {
          // Show validation errors from server
          showValidationErrors(result.errors);
        } else if (response.status === 429) {
          // Rate limited
          showErrorMessage('Terlalu banyak pengiriman. Silakan coba lagi dalam 1 jam.');
        } else {
          throw new Error(result.message || 'Server error');
        }
        return;
      }

      // Success
      showSuccessMessage();
      e.target.reset();

    } catch (error) {
      console.error('Form submission error:', error);
      showErrorMessage('Terjadi kesalahan. Silakan coba lagi nanti.');
    } finally {
      // Reset button state
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    }
  });

  function validateClientSide(data: any): Record<string, string> {
    const errors: Record<string, string> = {};

    // Basic client validation
    if (!data.name || data.name.trim().length < 2) {
      errors.name = 'Nama minimal 2 karakter';
    }
    if (!data.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
      errors.email = 'Format email tidak valid';
    }
    if (!data.subject || data.subject.trim().length < 5) {
      errors.subject = 'Subjek minimal 5 karakter';
    }
    if (!data.message || data.message.trim().length < 10) {
      errors.message = 'Pesan minimal 10 karakter';
    }
    if (!data.gdpr_consent) {
      errors.gdpr_consent = 'Anda harus menyetujui kebijakan privasi';
    }

    return errors;
  }

  function showValidationErrors(errors: Record<string, string>) {
    Object.entries(errors).forEach(([field, message]) => {
      const input = document.querySelector(`[name="${field}"]`);
      if (input) {
        input.classList.add('border-red-500');

        // Create or update error message
        let errorDiv = input.parentNode.querySelector('.error-message');
        if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.className = 'error-message text-red-500 text-sm mt-1';
          input.parentNode.appendChild(errorDiv);
        }
        errorDiv.textContent = message;
      }
    });

    // Show general error message
    showErrorMessage('Mohon perbaiki kesalahan di form ini.');
  }

  function clearValidationErrors() {
    document.querySelectorAll('.error-message').forEach(el => el.remove());
    document.querySelectorAll('input, textarea').forEach(el => {
      el.classList.remove('border-red-500');
    });
    hideMessages();
  }

  function showSuccessMessage() {
    document.getElementById('successMessage').classList.remove('hidden');
    document.getElementById('errorMessage').classList.add('hidden');
    setTimeout(hideMessages, 5000);
  }

  function showErrorMessage(message: string) {
    const errorEl = document.getElementById('errorMessage');
    if (errorEl) {
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
    }
    document.getElementById('successMessage').classList.add('hidden');
    setTimeout(hideMessages, 5000);
  }

  function hideMessages() {
    document.getElementById('successMessage').classList.add('hidden');
    document.getElementById('errorMessage').classList.add('hidden');
  }
</script>

<style>
  /* Form validation styling */
  input:invalid, select:invalid, textarea:invalid {
    border-color: #dc2626;
  }

  input:valid, select:valid, textarea:valid {
    border-color: #059669;
  }

  /* Checkbox styling */
  input[type="checkbox"]:checked {
    background-color: #dc2626;
    border-color: #dc2626;
  }
</style>